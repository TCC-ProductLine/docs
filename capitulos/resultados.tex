\chapter{Resultados}
\label{chapter:Resultados}

\section{Testes unitários}

Durante todo o desenvolvimento do SocialFramework foi eleborado uma suíte de testes para tentar garantir que cada ponto do código funcione da devida maneira. Desse modo, o desenvolvedor pode inserir novos códigos, módulos ou alterar um código existente, com mais tranquilidade e sabendo que o restante de código irá funcionar adequadamente. Caso algum resultado esperado seja diferente do obtido a suite de testes irá apontar a falha.

Para a realização dos testes foi utilizada a \textit{gem} do Rspec, essa \textit{gem} é amplamente utilizada pela comunidade do Rails. E para a visualização do relatório de testes foi utilizado o Code Climate, que é uma ferramenta online que realiza uma análise estática do código fonte, atualmente é suportado as linguagens: Ruby, Python, JavaScript e PHP.

No início do desenvolvimento foi estabelecido uma meta de que se deveria testar no mínimo 90\% do código fonte. Essa meta foi cumprida obtendo-se 98,8\% de cobertura do código, porém essa métrica não corresponde a realidade. pois os arquivos ``elements\_factory.rb'', ``elements\_factory\_default.rb'' e ``graph\_elements.rb'' tiveram a cobertura, respectivamente, de 60\%, 80\% e 84\%, diminuindo a cobertura real do código fonte, entretando esses arquivos possuem classes ``abstratas'' e deveriam ser desconsiderados. Porém, em Ruby não existe o conceito de classe abstrata, entretanto Olsen apresenta uma abordagem de se obter esse conceito em seu livro \cite{Olsen:2007}. Um exemplo dessa abordagem pode ser observada a seguir:

 \begin{lstlisting}[
    label=listing:classe_abstrata,
    caption=Classe abstrata,
    numbers=left,
    language=Ruby,
    basicstyle=\footnotesize\sffamily,
    keywordstyle=\color{red},
    stringstyle=\color{blue},
]
# Define abstract methods to Vertex
class Edge
  attr_accessor :origin, :destiny, :labels
  
  # Constructor to Edge
  # ====== Params:
  # +origin+:: +Vertex+ relationship origin
  # +destiny+:: +Vertex+ relationship destiny
  # Returns NotImplementedError
  def initialize origin, destiny
    raise 'Must implement method in subclass'
  end
end
\end{lstlisting}

A seguir é apresentado na Figura \ref{Cobertura_teste} cada arquivo e sua cobertura.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.60]{figuras/resultados/cobertura.eps}
	\caption[Cobertura de teste]{Cobertura de teste}
	\label{Cobertura_teste}
\end{figure}

\section{Relatório de desempenho}

Após a verificação do correto fluxo que o \textit{framework} executa, foi realizado testes de desempenho do mesmo, analisando o tempo de execução e o consumo de memória dos principais algoritmos desenvolvidos. Não foram realizados esses teste no módulo de rotas pois os seus métodos fazem somente requisições de rotas à API do Google Maps e comparações sobre sobre essas rotas.

Para se obter cada valor, foram feitas cinco medições e foi realizada a média aritmética dos valores.

\subsection{Módulo de usuário}

Para o módulo de usuário foram realizados testes com 100 mil usuários, 50 mil usuários, 20 mil usuários e 10 mil usuários. Para todos esses casos cada usuário possuia 300 amigos e estava presente em 10 eventos.

\subsubsection{Tempo de execução}

Para o método ``build'', que é responsável por construir o grafo a partir de um usuário raiz, foi especificado que o grafo deveria ser construido com três níveis de profundidade. Obtendo-se o gráfico da Figura \ref{build_tempo} como resultado.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.8]{figuras/resultados/graficos/network/tempo/build.eps}
	\caption[Construção]{Construção}
	\label{build_tempo}
\end{figure}

Para o método ``search'', que é responsável por fazer pesquisas no grafo, foram feitas 3 tipos de pesquisas. A pesquisa padrão é uma pesquisa na qual será encontrado os vértices até o segundo nível do grafo. A pesquisa no terceiro nível é uma pesquisa que irá percorrer até o último nível do grafo. A pesquisa inválida é uma pesquisa que não serão encontrado resultados no grafo e também não serão encontrados no banco de dados, portanto todos os registros serão verificados. Pode-se visualizar o resultado dessas pesquisas na Figura \ref{search_tempo}.

\newpage

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.8]{figuras/resultados/graficos/network/tempo/pesquisas.eps}
	\caption[Pesquisas]{Pesquisas}
	\label{search_tempo}
\end{figure}

Para o método ``suggest\_relationships'', foi utilizado o parâmetro padrão para a quantidade de relacionamento para realizar a sugestão, que é cinco. Os tempos de execução para esse método pode ser visualizado na Figura \ref{suggest}.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.8]{figuras/resultados/graficos/network/tempo/sugerir.eps}
	\caption[Sugestão de relacionamentos]{Sugestão de relacionamentos}
	\label{suggest}
\end{figure}

\subsubsection{Consumo de memória}

O consumo de memória que o método ``build'' utilizou pode ser visualizado na Figura \ref{build_memoria}.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.8]{figuras/resultados/graficos/network/memoria/build_memoria.eps}
	\caption[Consumo de memória do método build]{Consumo de memória do método build}
	\label{build_memoria}
\end{figure}

Os métodos ``search'' e ``suggest\_relationships'', que tiveram seus tempos de execução apresentados na seção anterior não tiveram o seu consumo de memória medido, pois esses apenas utilizam a instância do grafo gerado pelo método ``build''.

\subsection{Módulo de agenda}

No módulo de agenda o método que teve o seu desempenho mensuarado foi o ``verify\_availabilities'', o qual verifica o melhor horário para um evento levando em consideração um conjunto de usuários. Para tal, fui utilizado o \textit{slote} com o tamanho de 1 hora e considerou-se que os eventos poderiam ser marcados no horário de 08:00 às 12:00.

Para esse método deve-se considerar duas variáveis que podem inflênciar o seu desempenho, que são o número de usuários e o intervaldo de tempo. Portando foram feitas duas baterias de testes, no qual cada bateria de teste tinha uma dessas variáveis fixa, enquanto a outra variável era alterada.

\subsubsection{Intervaldo de tempo fixo}

Com o intervalo de tempo fixo, foram feitos testes com o número de usuários variando a partir dos valores: 10, 50, 100, 300 e 500.

\subsubsubsection{Tempo de execução}
A seguir é apresentado na Figura \ref{31dias_tempo} o tempo de execução do método ``verify\_availabilities'' com o intervalo de tempo de 31 dias.

\newpage

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.8]{figuras/resultados/graficos/schedule/tempo/dias/31dias_tempo.eps}
	\caption[Tempo de execução com disponibilidade de 31 dias]{Tempo de execução com disponibilidade de 31 dias}
	\label{31dias_tempo}
\end{figure}

\subsubsubsection{Consumo de memória}

Na Figura \ref{31dias_memoria} pode-se visualizar a quantidade de memória consumada com um intervalo de tempo de 31 dias.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.8]{figuras/resultados/graficos/schedule/memoria/dias/31dias_memoria.eps}
	\caption[Consumo de memória com disponibilidade de 31 dias]{Consumo de memória com disponibilidade de 31 dias}
	\label{31dias_memoria}
\end{figure}

\subsubsection{Número de usuários fixo}

Com o número de usuários fixo, foi realizado testes com o intervalo de tempo variando entre 7, 15 e 31 dias.

\subsubsubsection{Tempo de execução}

É possível observar na Figura \ref{500users_tempo} o tempo de execução quando o número de usuários é fixo em 500 e o intervalo de tempo é variável.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.8]{figuras/resultados/graficos/schedule/tempo/users/500users_tempo.eps}
	\caption[Tempo de execução para 500 usuários]{Tempo de execução para 500 usuários}
	\label{500users_tempo}
\end{figure}

\subsubsubsection{Consumo de memória}

A quantidade de memória consumida com 500 usuários fixos, pode ser obeservada na Figura \ref{500users_memoria}.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.8]{figuras/resultados/graficos/schedule/memoria/users/500users_memoria.eps}
	\caption[Consumo de memória para 500 usuários]{Consumo de memória para 500 usuários}
	\label{500users_memoria}
\end{figure}

% falar se é linear

\section{Qualidade do SocialFramework}

Essa seção irá evidenciar o resultado da qualidade do código fonte do \textit{framework}. A partir da análise de código fonte realizada pela ferramenta Code Climate foi possível obter as métricas e realizar uma análise qualitatica dos resultados obtidos.

Medir e monitorar a qualidade do software é fundamental. Mesmo uma ótima suíte de testes pode produzir informações apenas sobre características externas, não refletindo qualidades como manutenabilidade, modularidade, flexibilidade e simplicidade \cite{Filho:2013}.

Filho afirma ainda que nem tudo vale a pena controlar. Portanto, não se deve procurar medir tudo, mas escolher bem as métricas para avaliar e controlar o projeto \cite{Filho:2013}. Desse modo, as métricas que foram monitoradas durante o projeto foram:

\begin{enumerate}
	\item \textbf{Complexidade}: Essa métrica fornece uma análise da complexidade e do esforço gasto em um trecho de código. Para isso é utilazado as seguintes métricas;
	\begin{enumerate}
		\item \textbf{Complexidade ciclomática}: é calculada pela quantidade de caminhos que é possível percorrer no método. Dessa forma, sempre começa em 1, pois todo método tem pelo menos um caminho possível. Para cada estrutura condicional ou repetitiva( if, unless, elsif, while, until, for, when, rescue ) é adicionado mais 1 para a complexidade;
		\item \textbf{Tamanho do código}: que é a quantidade de linhas que o código possui, desconsiderando comentários e espaços em branco;
		\item \textbf{Complexidade ABC}: o cálculo da complexidade é baseado em três pontos:
		\begin{enumerate}
			\item \textbf{Assignment}: qualquer atribuição explícita de um dado para uma variável, por exemplo: = *= /= \%= += <<= >>= \&= |= >= ++ —, etc;
		    \item \textbf{Branch}: quando um caminho fora do escopo do programa é feito, por exemplo: uma chamada de método de instância de um objeto, um operador new instanciando uma classe, etc;
    		\item \textbf{Condition}: qualquer teste lógico/booleano, == != <= >= < > else case default try catch ? e condicionais unários.
		\end{enumerate}
	\end{enumerate}
	\item \textbf{Duplicação de código}: analisa a similaridade de trechos de código na aplicação. Para cada nível de similaridade, é atribuido um peso diferente, indo de similar até identico, resultando no número que é a somatória de todos os arquivos. Espaços em branco, nomes de variáveis, métodos e classes são ignorados pela ferramenta;
	\item \textbf{Estilo}: Verifica se o projeto utiliza o guia de estilo descrito pela comunidade Rails. E aponta onde estão as más práticas relacionadas a padrões e convenções que não estão sendo respeitadas na aplicação;
	\item \textbf{Segurança}: Utiliza um \textit{fork} do Brakeman na versão 2.6.2 para identificar as vulnerabilidades do projeto Rails.
\end{enumerate}

\newpage

A partir dessas métricas o Code Climate realiza o cálculo do GPA (\textit{grade point average}) que é uma espécie de média de todos os arquivos do projeto, o GPA possui um intervalo de 0 a 4 pontos, levando em consideração as notas dos arquivos, que varia de `A' a `F'. Desse modo, no início do projeto foi estabelacio uma meta de 3 pontos. Essa meta foi atingida com exito, obtendo-se 3.29 pontos, como pode ser observado na Figura \ref{GPA}.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.5]{figuras/resultados/gpa.eps}
	\caption[GPA]{GPA}
	\label{GPA}
\end{figure}

Esse valor do GPA foi obtido de acordo com a Tabela \ref{gpa_arquivos}, que ilustra a quantidade de arquivos com as notas de `A' até `F'.

\begin{table}[!h]
\centering
\caption{Nota de cada arquivo}
\label{gpa_arquivos}
\begin{tabular}{cccccc}
\toprule
\textbf{Nota A} & \textbf{Nota B} & \textbf{Nota C} & \textbf{Nota D} & \textbf{Nota E} & \textbf{Nota F} \\ \midrule
50 & 1 & 1 & 1 & 0 & 0							   \\ \bottomrule
\end{tabular}
\end{table}

\section{SocialBike}
\label{sec:SocialBike}

A SocialBike é a rede social desenvolvida para fazer uso do SocialFramework e, dessa forma, aplicá-lo em um uso real para comprovação de seus recuros. É uma rede voltada para ciclistas que auxilia os mesmos a principalmente marcarem eventos em comum para andar de bicicleta e/ou verificar rotas de outros usuários que coincidam com as suas. Nessa rede foram desenvolvidas funcionalidades que perpassam pelos três módulos do SocialFramework, Usuários, Agenda e Rotas.

Para os módulos de usuários foram desenvolvidas funcionalidades gerais de redes sociais, com cadastro de usuários, login, relacionamentos e pesquisas. A seguir são apresentadas uma sequência de imagens da SocialBike com as telas dessas funcionalidades.

A figura \ref{cadastrar_usuario} apresenta a tela de cadastro de usuários. Quando um usuário se cadastra na rede é automaticamente logado na mesma.

\newpage
\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.4]{figuras/resultados/cadastrar_usuario.eps}
	\caption[Tela de cadastro de usuários]{Tela de cadastro de usuários}
	\label{cadastrar_usuario}
\end{figure}

A figura \ref{login} apresenta a tela para entrar na rede social.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.5]{figuras/resultados/login.eps}
	\caption[Tela de login]{Tela de login}
	\label{login}
\end{figure}

A figura \ref{home} mostra a tela principal da rede social, com as listas dos amigos e sugestões de amizades para o usuário logado além de um campo para relaização de pesquisas.

\newpage
\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.5]{figuras/resultados/home.eps}
	\caption[Tela principal]{Tela principal}
	\label{home}
\end{figure}

A figura \ref{pesquisa} mostra os resultados retornados quando um usuário faz uma pesquisa. Ao se realizar uma pesquisa é apresentado o botão ``Continuar'', para que o usuário continue retornando mais resultados da pesquisa realizada, nesse caso a tabela com os resultados é incrementada.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.5]{figuras/resultados/pesquisa.eps}
	\caption[Resultados da pesquisa]{Resultados da pesquisa}
	\label{pesquisa}
\end{figure}

Na sequência, as figuras \ref{criar_evento} e \ref{evento} mostram, respectivamente, as telas para criação de eventos e a visualização desses eventos, com a possibilidade de convidar usuários.

\newpage
\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.5]{figuras/resultados/criar_evento.eps}
	\caption[Criar Evento]{Criar Evento}
	\label{criar_evento}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.5]{figuras/resultados/evento.eps}
	\caption[Visualizar Evento]{Visualizar Evento}
	\label{evento}
\end{figure}

A tela apresentada na figura \ref{compatibilidade_horarios} é usada para verificar a compatibilidade de horários para marcação de um evento em um determinado período de tempo. Têm-se a lista de amigos do usuário logado para que este possa adicioná-los juntamente com seus pesos para realizar a verificação. Outros atributos que devem ser passados são os já mencionados antes que são necessários para a execução do algoritmo.

\newpage
\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.5]{figuras/resultados/compatibilidade_horarios.eps}
	\caption[Verificar compatibilidade de horários]{Verificar compatibilidade de horários}
	\label{compatibilidade_horarios}
\end{figure}

As imagens \ref{cadastrar_rota} e \ref{ver_rota} mostram, respectivamente, as telas para criação e visualização de rotas.

\newpage
\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.5]{figuras/resultados/cadastrar_rota.eps}
	\caption[Cadastrar Rota]{Cadastrar Rota}
	\label{cadastrar_rota}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.5]{figuras/resultados/ver_rota.eps}
	\caption[Visualizar Rota]{Visualizar Rota}
	\label{ver_rota}
\end{figure}

Por fim, têm-se as imagens \ref{comparar_rotas} e \ref{resultado_comparacao}. Nessas imagens pode-se ver um formulário para realizar a comparação entre duas rotas e o resultado dessa comparação, em que é apresentado que as rotas são compatíveis e qual a nova distância total para a rota principal que será alterada para atender a rota secundária.

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.5]{figuras/resultados/comparar_rotas.eps}
	\caption[Comparar rotas]{Comparar rotas}
	\label{comparar_rotas}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.5]{figuras/resultados/resultado_comparacao.eps}
	\caption[Resultado da comparação]{Resultado da comparação}
	\label{resultado_comparacao}
\end{figure}

O código da SocialBike pode ser acessado através do endereço \url{https://github.com/TCC-SocialNetwork/social_bike}.

\section{Resumo do Capítulo}
Este capítulo foi responsável por apresentar os resultados obtidos durante todo o processo de desenvolvimento, tanto do SocialFramewok quanto da rede social SocialBike.

Foram apresentados alguns relatórios contendo todos os resultados. Como o relatório de testes mostrando toda a cobertura de código, os principais relatórios de desempenho, que apresentam como os algoritmos se comportaram em complexidade e uso de memória e os principais relatórios de qualidade onde foi usado o \textit{CodeClimate} para aferir as principais medidas de qualidade de software.

Além disso também foi apresentada a rede social SocialBike e suas funcionalidades que foram todas desenvolvidas a partir dos recursos do SocialFramework para uma melhor análise de uso do mesmo.
